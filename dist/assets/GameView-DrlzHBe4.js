import{d as k,w as W,e as $,R as E,o as b,c as A,a as e,F as H,r as K,t as _,f as D,b as w,g as I,n as L,_ as M,h as N,i as V,j as x,M as B,k as q,l as F,m as U,p as j,u as S}from"./index-Crvd5xHI.js";var c=(s=>(s.ROCK="rock",s.PAPER="paper",s.SCISSORS="scissors",s))(c||{}),O=(s=>(s.WIN="win",s.LOSE="lose",s.DRAW="draw",s))(O||{});const Y={class:"game-board"},z={class:"choices-container"},X=["onClick","disabled"],J={class:"choice-emoji"},Q={class:"choice-label"},Z={key:0,class:"result-section"},ee={class:"result-display"},te={class:"result-emoji"},se={class:"result-text"},ne={class:"choices-comparison"},ae={class:"comparison-item"},oe={class:"comparison-emoji"},le={class:"comparison-item"},ie={class:"comparison-emoji"},ce={class:"auto-reset-hint"},re=2e3,ue=k({__name:"RPSGameBoard",props:{isPlaying:{type:Boolean},playerChoice:{},computerChoice:{},currentResult:{}},emits:["play","play-again"],setup(s,{emit:y}){const r=s,C=y,m=w(0);let v=null;const p=w("自动进入下一局...");function n(){let l=Math.ceil(re/1e3);m.value=l,v=window.setInterval(()=>{l--,m.value=l,l<=0&&u()},1e3)}function u(){v!==null&&(clearInterval(v),v=null),m.value=0}W(()=>r.currentResult,l=>{l!==null?n():u()}),W(m,l=>{l>0?p.value=`${l}秒后自动进入下一局`:p.value="即将开始新局..."}),$(()=>{u()});const R=[{value:c.ROCK,...E.rock},{value:c.PAPER,...E.paper},{value:c.SCISSORS,...E.scissors}];function t(l){return r.playerChoice===l}function a(l){!r.isPlaying&&!r.currentResult&&C("play",l)}function i(){return r.currentResult&&I[r.currentResult]?.emoji||""}function d(){return r.currentResult&&I[r.currentResult]?.label||""}function o(l){return l&&E[l]?.emoji||""}function f(){C("play-again")}return(l,g)=>(b(),A("div",Y,[g[3]||(g[3]=e("div",{class:"game-info"},[e("h2",{class:"game-title"},"石头 剪刀 布"),e("p",{class:"game-subtitle"},"选择你的出招")],-1)),e("div",z,[(b(),A(H,null,K(R,P=>e("button",{key:P.value,class:L(["choice-button",{"choice-button--active":t(P.value)}]),onClick:h=>a(P.value),disabled:s.isPlaying},[e("span",J,_(P.emoji),1),e("span",Q,_(P.label),1)],10,X)),64))]),s.currentResult?(b(),A("div",Z,[e("div",ee,[e("span",te,_(i()),1),e("span",se,_(d()),1)]),e("div",ne,[e("div",ae,[g[0]||(g[0]=e("span",{class:"comparison-label"},"你",-1)),e("span",oe,_(o(s.playerChoice)),1)]),g[2]||(g[2]=e("span",{class:"vs-text"},"VS",-1)),e("div",le,[g[1]||(g[1]=e("span",{class:"comparison-label"},"电脑",-1)),e("span",ie,_(o(s.computerChoice)),1)])]),e("p",ce,_(p.value),1),e("button",{class:"play-again-button",onClick:f}," 立即开始 ")])):D("",!0)]))}}),de=M(ue,[["__scopeId","data-v-0c404146"]]),me={class:"score-board"},pe={class:"score-stats"},fe={class:"stat-item"},he={class:"stat-value"},ve={class:"stat-item stat-item--win"},Ce={class:"stat-value"},ge={class:"stat-item stat-item--lose"},ye={class:"stat-value"},_e={class:"stat-item stat-item--draw"},Re={class:"stat-value"},Se={class:"win-rate"},we={class:"win-rate-bar"},Pe={class:"win-rate-value"},be={key:0,class:"history-section"},Ae={class:"history-list"},Ee={class:"history-choices"},Oe={class:"history-choice"},$e={class:"history-choice"},Ie=k({__name:"RPSScoreBoard",props:{totalGames:{},playerWins:{},computerWins:{},drawCount:{},playerWinRate:{},gameHistory:{}},emits:["reset"],setup(s,{emit:y}){const r=y;function C(){r("reset")}function m(p){return E[p].label}function v(p){return I[p].label}return(p,n)=>(b(),A("div",me,[e("div",{class:"score-header"},[n[1]||(n[1]=e("h3",{class:"score-title"},"游戏统计",-1)),e("button",{class:"reset-button",onClick:C,"aria-label":"重置统计"},[...n[0]||(n[0]=[e("span",{class:"reset-icon"},"↺",-1)])])]),e("div",pe,[e("div",fe,[n[2]||(n[2]=e("span",{class:"stat-label"},"总场次",-1)),e("span",he,_(s.totalGames),1)]),e("div",ve,[n[3]||(n[3]=e("span",{class:"stat-label"},"胜利",-1)),e("span",Ce,_(s.playerWins),1)]),e("div",ge,[n[4]||(n[4]=e("span",{class:"stat-label"},"失败",-1)),e("span",ye,_(s.computerWins),1)]),e("div",_e,[n[5]||(n[5]=e("span",{class:"stat-label"},"平局",-1)),e("span",Re,_(s.drawCount),1)])]),e("div",Se,[n[6]||(n[6]=e("span",{class:"win-rate-label"},"胜率",-1)),e("div",we,[e("div",{class:"win-rate-fill",style:N({width:`${s.playerWinRate}%`})},null,4)]),e("span",Pe,_(s.playerWinRate)+"%",1)]),s.gameHistory.length>0?(b(),A("div",be,[n[8]||(n[8]=e("h4",{class:"history-title"},"历史记录",-1)),e("ul",Ae,[(b(!0),A(H,null,K(s.gameHistory,(u,R)=>(b(),A("li",{key:R,class:"history-item"},[e("div",Ee,[e("span",Oe,_(m(u.playerChoice)),1),n[7]||(n[7]=e("span",{class:"history-separator"},"vs",-1)),e("span",$e,_(m(u.computerChoice)),1)]),e("span",{class:L(["history-result",`history-result--${u.result}`])},_(v(u.result)),3)]))),128))])])):D("",!0)]))}}),ke=M(Ie,[["__scopeId","data-v-1f1e62eb"]]),Me=V("game",()=>{const s=w(null),y=w(null),r=w(null),C=w(!1),m=w(0),v=w(0),p=w(0),n=w([]),u=x(()=>m.value+v.value+p.value),R=x(()=>u.value===0?0:Math.round(m.value/u.value*100));function t(){C.value=!0,s.value=null,y.value=null,r.value=null}function a(h){s.value=h}function i(h){y.value=h}function d(h){r.value=h}function o(h){h==="win"?m.value++:h==="lose"?v.value++:p.value++}function f(h){n.value.unshift(h),n.value.length>B&&(n.value=n.value.slice(0,B))}function l(){C.value=!1}function g(){s.value=null,y.value=null,r.value=null,C.value=!1}function P(){m.value=0,v.value=0,p.value=0,n.value=[],g()}return{playerChoice:s,computerChoice:y,currentResult:r,isPlaying:C,playerWins:m,computerWins:v,drawCount:p,gameHistory:n,totalGames:u,playerWinRate:R,startGame:t,setPlayerChoice:a,setComputerChoice:i,setCurrentResult:d,updateScore:o,addHistory:f,endGame:l,resetGame:g,resetAllStats:P}});function Te(){function s(t){const a=new Map;return a.set(c.ROCK,0),a.set(c.PAPER,0),a.set(c.SCISSORS,0),t.forEach(i=>{const d=a.get(i.playerChoice)||0;a.set(i.playerChoice,d+1)}),a}function y(t){const a=new Map;[c.ROCK,c.PAPER,c.SCISSORS].forEach(i=>{const d=new Map;d.set(c.ROCK,0),d.set(c.PAPER,0),d.set(c.SCISSORS,0),a.set(i,d)});for(let i=0;i<t.length-1;i++){const d=t[i].playerChoice,o=t[i+1].playerChoice,f=a.get(d);if(f){const l=f.get(o)||0;f.set(o,l+1)}}return a}function r(t){if(t.length<3)return null;const a=s(t),i=t[0].playerChoice;let d=0,o=null;if(a.forEach((f,l)=>{l!==i&&f>d&&(d=f,o=l)}),!o){const f=["rock","paper","scissors"];return f[Math.floor(Math.random()*f.length)]}return o}function C(t){if(t.length<2)return null;const a=y(t),i=t[0].playerChoice,d=a.get(i);if(!d)return null;let o=0,f=null;return d.forEach((l,g)=>{l>o&&(o=l,f=g)}),!f||o===0?r(t):f}function m(t){if(t.length<6)return null;const a=t.slice(0,3).map(i=>i.playerChoice);for(let i=3;i<t.length-2;i++){const d=t.slice(i,i+3).map(o=>o.playerChoice);if(v(a,d)&&i+3<t.length)return t[i+3].playerChoice}return null}function v(t,a){return t[0]===a[0]&&t[1]===a[1]&&t[2]===a[2]}function p(t){return{[c.ROCK]:c.SCISSORS,[c.PAPER]:c.ROCK,[c.SCISSORS]:c.PAPER}[t]}function n(){const t=[c.ROCK,c.PAPER,c.SCISSORS];return t[Math.floor(Math.random()*t.length)]}function u(t){if(t.length<2)return n();let a=null;return a=m(t),a||(a=C(t)),a||(a=r(t)),a?p(a):n()}function R(t){return t.length<2?"random":m(t)?"pattern":C(t)?"markov":r(t)?"frequency":"random"}return{getAIChoice:u,getStrategyType:R,calculateFrequencies:s,buildTransitionMatrix:y}}function Ge(){const s=Me(),{getAIChoice:y}=Te();function r(){return y(s.gameHistory)}function C(n,u){return n===u?O.DRAW:{[c.ROCK]:c.SCISSORS,[c.PAPER]:c.ROCK,[c.SCISSORS]:c.PAPER}[n]===u?O.WIN:O.LOSE}function m(n){s.startGame(),s.setPlayerChoice(n);const u=r();s.setComputerChoice(u);const R=C(n,u);s.setCurrentResult(R),s.updateScore(R);const t={playerChoice:n,computerChoice:u,result:R,timestamp:Date.now()};s.addHistory(t),s.endGame()}function v(){s.resetGame()}function p(){s.resetAllStats()}return{...q(s),playRound:m,resetGame:v,resetAllStats:p}}const We={class:"game-view"},xe={class:"container"},Be={class:"game-layout"},je={class:"game-main"},He={class:"game-sidebar"},Ke=2e3,De=k({__name:"GameView",setup(s){const{isPlaying:y,playerChoice:r,computerChoice:C,currentResult:m,playerWins:v,computerWins:p,drawCount:n,gameHistory:u,totalGames:R,playerWinRate:t,playRound:a,resetGame:i,resetAllStats:d}=Ge();let o=null;function f(h){o!==null&&clearTimeout(o),a(h)}function l(){o!==null&&(clearTimeout(o),o=null),d()}function g(){o!==null&&(clearTimeout(o),o=null),i()}function P(){window.close()}return F(()=>{m.value!==null&&(o!==null&&clearTimeout(o),o=window.setTimeout(()=>{i(),o=null},Ke))}),$(()=>{o!==null&&clearTimeout(o)}),U(()=>{const h=new BroadcastChannel("woodcat-games");h.onmessage=T=>{const G=T.data;G.type==="close-game"&&G.gameRoute!=="/game/rock-paper-scissors"&&(h.close(),window.close())},$(()=>{h.close()})}),(h,T)=>(b(),A("div",We,[e("div",xe,[e("div",{class:"game-header"},[e("button",{onClick:P,class:"back-button"},"← 返回首页")]),e("div",Be,[e("div",je,[j(de,{"is-playing":S(y),"player-choice":S(r),"computer-choice":S(C),"current-result":S(m),onPlay:f,onPlayAgain:g},null,8,["is-playing","player-choice","computer-choice","current-result"])]),e("div",He,[j(ke,{"total-games":S(R),"player-wins":S(v),"computer-wins":S(p),"draw-count":S(n),"player-win-rate":S(t),"game-history":S(u),onReset:l},null,8,["total-games","player-wins","computer-wins","draw-count","player-win-rate","game-history"])])])])]))}}),Ne=M(De,[["__scopeId","data-v-e44bcde3"]]);export{Ne as default};
