import{b as w,w as le,k as O,d as te,e as oe,o as p,c as A,F as R,a as e,t as S,u as r,r as F,i as J,n as Q,g as Z,_ as ae,f as ne,p as ee,s as ie,v as re,q as ce}from"./index-CWkIdGNN.js";import{p as x}from"./persistenceService-D2TLTx3Y.js";import{a as z,S as U,v as j,V as q}from"./vibrationService-DXRESRMj.js";const h=15;var s=(o=>(o[o.EMPTY=0]="EMPTY",o[o.BLACK=1]="BLACK",o[o.WHITE=2]="WHITE",o))(s||{}),_=(o=>(o.PLAYING="playing",o.BLACK_WINS="black_wins",o.WHITE_WINS="white_wins",o.DRAW="draw",o))(_||{}),P=(o=>(o.PVP="pvp",o.PVE="pve",o))(P||{});function se(){const o=w([]),l=w(s.BLACK),a=w(_.PLAYING),c=w(P.PVP),i=w(null),k=w(0),I=w(0);function M(){const t=x.loadGomokuGame();k.value=t.stats.blackWins,I.value=t.stats.whiteWins,n()}function K(){const t=x.loadGomokuGame();x.saveGomokuGame({stats:t.stats,gameState:null})}le([k,I],()=>{const t=x.loadGomokuGame();x.saveGomokuGame({stats:{blackWins:k.value,whiteWins:I.value},gameState:t.gameState})}),M();const y=w(!1),N=O(()=>a.value===_.BLACK_WINS?"é»‘å­èŽ·èƒœï¼":a.value===_.WHITE_WINS?"ç™½å­èŽ·èƒœï¼":a.value===_.DRAW?"å¹³å±€ï¼":c.value===P.PVE?l.value===i.value?"AIæ€è€ƒä¸­...":"ä½ çš„å›žåˆ":l.value===s.BLACK?"é»‘å­å›žåˆ":"ç™½å­å›žåˆ");function $(t,v,T){let g=0;const m=[[[0,1],[0,-1]],[[1,0],[-1,0]],[[1,1],[-1,-1]],[[1,-1],[-1,1]]];for(const u of m){let d=0,E=0;for(const[b,B]of u){let H=t+b,Y=v+B;for(;H>=0&&H<h&&Y>=0&&Y<h;){if(o.value[H][Y]===T)d++;else{if(o.value[H][Y]===s.EMPTY)break;E++;break}H+=b,Y+=B}}d>=4?g+=1e5:d===3?E===0?g+=1e4:E===1&&(g+=1e3):d===2?E===0?g+=1e3:E===1&&(g+=100):d===1&&(E===0?g+=100:E===1&&(g+=10))}return g}function V(){if(!i.value)return null;const t=i.value,v=t===s.BLACK?s.WHITE:s.BLACK;let T=-1/0,g=null;for(let m=0;m<h;m++)for(let u=0;u<h;u++)if(o.value[m][u]===s.EMPTY){const d=$(m,u,t),E=$(m,u,v),b=Math.max(d,E*1.1);b>T&&(T=b,g={row:m,col:u})}if(g===null||T<100){const m=Math.floor(h/2);for(let u=m-2;u<=m+2;u++)for(let d=m-2;d<=m+2;d++)if(u>=0&&u<h&&d>=0&&d<h&&o.value[u][d]===s.EMPTY)return{row:u,col:d}}return g}function C(){if(console.log("=== aiMove START ===",{gameState:a.value,currentPlayer:l.value,aiPlayer:i.value,gameMode:c.value,isAIThinking:y.value,isAIturn:l.value===i.value}),a.value!==_.PLAYING){console.log("aiMove FAILED: game not playing, gameState =",a.value);return}if(l.value!==i.value){console.log("aiMove FAILED: not AI turn",{currentPlayer:l.value,aiPlayer:i.value});return}y.value=!0,console.log("aiMove: set isAIThinking = true"),setTimeout(()=>{console.log("aiMove: executing getAIMove");const t=V();if(console.log("aiMove: getAIMove returned",t),t){console.log("aiMove: resetting isAIThinking and calling placePiece",t),y.value=!1;const v=W(t.row,t.col,!0);console.log("aiMove: placePiece returned",v)}else console.log("aiMove: no move found, resetting isAIThinking"),y.value=!1;console.log("=== aiMove END ===")},500)}function n(){o.value=[];for(let t=0;t<h;t++)o.value.push(new Array(h).fill(s.EMPTY))}function f(t,v,T){const g=[[[0,1],[0,-1]],[[1,0],[-1,0]],[[1,1],[-1,-1]],[[1,-1],[-1,1]]];for(const m of g){let u=1;for(const[d,E]of m){let b=t+d,B=v+E;for(;b>=0&&b<h&&B>=0&&B<h&&o.value[b][B]===T;)u++,b+=d,B+=E}if(u>=5)return!0}return!1}function L(){for(let t=0;t<h;t++)for(let v=0;v<h;v++)if(o.value[t][v]===s.EMPTY)return!1;return!0}function W(t,v,T=!1){return console.log("=== placePiece START ===",{row:t,col:v,currentPlayer:l.value,gameMode:c.value,aiPlayer:i.value,isAIMove:T,isAIThinking:y.value,gameState:a.value}),a.value!==_.PLAYING?(console.log("placePiece FAILED: game not playing, gameState =",a.value),!1):o.value[t][v]!==s.EMPTY?(console.log("placePiece FAILED: position not empty"),!1):y.value&&!T?(console.log("placePiece FAILED: AI is thinking, player cannot move"),!1):(console.log("placePiece SUCCESS: placing piece at",t,v),o.value[t][v]=l.value,l.value===s.BLACK?(z.play(U.PLACE_BLACK),j.vibrate(q.PLACE_BLACK)):(z.play(U.PLACE_WHITE),j.vibrate(q.PLACE_WHITE)),f(t,v,l.value)?(a.value=l.value===s.BLACK?_.BLACK_WINS:_.WHITE_WINS,a.value===_.BLACK_WINS?k.value++:I.value++,z.play(U.WIN),j.vibrate(q.WIN),console.log("placePiece: player won"),!0):L()?(a.value=_.DRAW,z.play(U.DRAW),j.vibrate(q.DRAW),console.log("placePiece: draw"),!0):(l.value=l.value===s.BLACK?s.WHITE:s.BLACK,console.log("placePiece: switched player",{newCurrentPlayer:l.value,aiPlayer:i.value,isAIturn:l.value===i.value}),c.value===P.PVE&&l.value===i.value&&(console.log("placePiece: triggering AI move"),C()),console.log("=== placePiece END ==="),!0))}function G(){if(console.log("=== startNewGame START ===",{gameMode:c.value}),n(),a.value=_.PLAYING,y.value=!1,l.value=s.BLACK,console.log("startNewGame: set currentPlayer = BLACK"),c.value===P.PVE){const t=Math.random()<.5;console.log("startNewGame: assigning colors",{aiIsBlack:t}),t?(i.value=s.BLACK,console.log("startNewGame: AI is BLACK (first), player is WHITE"),setTimeout(()=>{console.log("startNewGame: triggering AI first move"),C()},300)):(i.value=s.WHITE,console.log("startNewGame: player is BLACK (first), AI is WHITE"))}else i.value=null,console.log("startNewGame: PvP mode, aiPlayer = null");console.log("startNewGame completed",{currentPlayer:l.value,aiPlayer:i.value,gameMode:c.value}),console.log("=== startNewGame END ===")}function D(t){c.value=t,G()}function X(){k.value=0,I.value=0,G()}return{board:o,currentPlayer:l,gameState:a,gameMode:c,aiPlayer:i,blackWins:k,whiteWins:I,isAIThinking:y,statusText:N,placePiece:W,startNewGame:G,setGameMode:D,resetAllStats:X,initBoard:n,loadGameState:M,clearGameState:K}}const ue={class:"gomoku-game"},ve={class:"game-header"},de={class:"score-info"},fe={class:"score-item"},me={class:"score-value"},ge={class:"score-item"},_e={class:"score-value"},pe={class:"status-text"},Ae={class:"game-board"},Pe={class:"board-container"},he={class:"board"},ke={class:"grid-lines"},Ie=["onClick"],ye={key:0,class:"game-over-overlay"},Ee={class:"game-over-content"},Ce={class:"game-over-icon"},Te={class:"game-over-title"},be=te({__name:"GomokuBoard",setup(o){const{board:l,gameState:a,blackWins:c,whiteWins:i,statusText:k,placePiece:I,startNewGame:M,resetAllStats:K,initBoard:y}=se();function N(n,f){return{left:`${3+f/14*94}%`,top:`${3+n/14*94}%`,transform:"translate(-50%, -50%)"}}function $(n,f){I(n,f)}function V(){M()}function C(){K()}return oe(()=>{l.value.length===0&&y()}),(n,f)=>(p(),A(R,null,[e("div",ue,[e("div",ve,[e("div",de,[e("div",fe,[f[0]||(f[0]=e("span",{class:"score-label"},"é»‘å­",-1)),e("span",me,S(r(c)),1)]),e("div",ge,[f[1]||(f[1]=e("span",{class:"score-label"},"ç™½å­",-1)),e("span",_e,S(r(i)),1)])]),e("div",pe,S(r(k)),1)]),e("div",Ae,[e("div",Pe,[e("div",he,[e("div",ke,[(p(),A(R,null,F(15,L=>e("div",{key:`h-${L}`,class:"grid-line grid-line-horizontal",style:J({top:`${(L-1)/14*100}%`})},null,4)),64)),(p(),A(R,null,F(15,L=>e("div",{key:`v-${L}`,class:"grid-line grid-line-vertical",style:J({left:`${(L-1)/14*100}%`})},null,4)),64))]),(p(!0),A(R,null,F(r(l),(L,W)=>(p(),A("div",{key:`row-${W}`},[(p(!0),A(R,null,F(L,(G,D)=>(p(),A("div",{key:`cell-${W}-${D}`,class:"intersection",style:J(N(W,D)),onClick:X=>$(W,D)},[G!==r(s).EMPTY?(p(),A("div",{key:0,class:Q(["stone",{"stone-black":G===r(s).BLACK,"stone-white":G===r(s).WHITE}])},null,2)):Z("",!0)],12,Ie))),128))]))),128))])])])]),r(a)!==r(_).PLAYING?(p(),A("div",ye,[e("div",Ee,[e("div",Ce,S(r(a)===r(_).DRAW?"ðŸ¤":"ðŸŽ‰"),1),e("div",Te,S(r(k)),1),e("div",{class:"game-over-buttons"},[e("button",{class:"new-game-button",onClick:V}," æ–°æ¸¸æˆ "),e("button",{class:"reset-all-button",onClick:C}," é‡ç½®ç»Ÿè®¡ ")])])])):Z("",!0)],64))}}),we=ae(be,[["__scopeId","data-v-8d584c42"]]),Le={class:"gomoku-view"},Se={class:"container"},We={key:0,class:"mode-selector"},Ge={class:"mode-selector-content"},Be={class:"mode-buttons"},Me={key:0,class:"first-player-info"},Ne={class:"first-player-text"},$e={key:1,class:"game-layout"},Ke={class:"game-main"},Ve={key:0,class:"color-hint-overlay"},De={class:"color-hint-content"},He={class:"color-hint-icon"},Ye={class:"color-hint-text"},Re=te({__name:"GomokuView",setup(o){const l=ce(),{gameMode:a,aiPlayer:c,startNewGame:i}=se(),k=w(!1),I=w(!1),M=O(()=>a.value!==P.PVE||!c.value?"é»‘å­å…ˆæ‰‹":c.value===s.BLACK?"AIå…ˆæ‰‹ï¼ˆé»‘å­ï¼‰":"ä½ å…ˆæ‰‹ï¼ˆé»‘å­ï¼‰"),K=O(()=>a.value!==P.PVE||!c.value||c.value===s.WHITE?"âš«":"âšª"),y=O(()=>a.value!==P.PVE||!c.value?"åŒäººå¯¹æˆ˜æ¨¡å¼":c.value===s.WHITE?"ä½ æ‰§é»‘æ£‹ï¼ˆå…ˆæ‰‹ï¼‰":"ä½ æ‰§ç™½æ£‹ï¼ˆåŽæ‰‹ï¼‰");function N(C){a.value=C}function $(){k.value=!0,i(),a.value===P.PVE&&(I.value=!0,setTimeout(()=>{I.value=!1},3e3))}function V(){l.push("/")}return oe(()=>{const C=new BroadcastChannel("woodcat-games");C.onmessage=n=>{const f=n.data;f.type==="close-game"&&f.gameRoute!=="/game/gomoku"&&(C.close(),window.close())},ne(()=>{C.close()})}),(C,n)=>(p(),A("div",Le,[e("div",Se,[e("div",{class:"game-header"},[e("button",{onClick:V,class:"back-button"},"â† è¿”å›žé¦–é¡µ")]),k.value?(p(),A("div",$e,[e("div",Ke,[ee(we)])])):(p(),A("div",We,[e("div",Ge,[n[5]||(n[5]=e("div",{class:"mode-selector-title"},"é€‰æ‹©æ¸¸æˆæ¨¡å¼",-1)),e("div",Be,[e("button",{class:Q(["mode-button",{"mode-button--active":r(a)===r(P).PVP}]),onClick:n[0]||(n[0]=f=>N(r(P).PVP))},[...n[2]||(n[2]=[e("div",{class:"mode-icon"},"ðŸ‘¥",-1),e("div",{class:"mode-name"},"åŒäººå¯¹æˆ˜",-1),e("div",{class:"mode-desc"},"ä¸¤ä¸ªçŽ©å®¶è½®æµä¸‹æ£‹",-1)])],2),e("button",{class:Q(["mode-button",{"mode-button--active":r(a)===r(P).PVE}]),onClick:n[1]||(n[1]=f=>N(r(P).PVE))},[...n[3]||(n[3]=[e("div",{class:"mode-icon"},"ðŸ¤–",-1),e("div",{class:"mode-name"},"äººæœºå¯¹æˆ˜",-1),e("div",{class:"mode-desc"},"ä¸ŽAIå¯¹æˆ˜ï¼ŒæŒ‘æˆ˜æ™ºèƒ½AI",-1)])],2)]),r(a)===r(P).PVE?(p(),A("div",Me,[n[4]||(n[4]=e("div",{class:"first-player-icon"},"ðŸŽ²",-1)),e("div",Ne,S(M.value),1)])):Z("",!0),e("button",{class:"start-game-button",onClick:$}," å¼€å§‹æ¸¸æˆ ")])])),ee(re,{name:"fade"},{default:ie(()=>[I.value?(p(),A("div",Ve,[e("div",De,[e("div",He,S(K.value),1),e("div",Ye,S(y.value),1)])])):Z("",!0)]),_:1})])]))}}),Ue=ae(Re,[["__scopeId","data-v-fb6e5b11"]]);export{Ue as default};
