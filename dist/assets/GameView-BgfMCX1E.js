import{d as x,w as j,f as M,R as $,o as P,c as A,a as e,F as V,r as q,t as g,g as F,b as w,h as G,n as U,_ as B,i as Y,j as z,k as D,M as H,l as X,m as J,e as Q,p as N,u as _,q as Z}from"./index-CWkIdGNN.js";import{a as I,S as W,v as k,V as T}from"./vibrationService-DXRESRMj.js";var r=(s=>(s.ROCK="rock",s.PAPER="paper",s.SCISSORS="scissors",s))(r||{}),O=(s=>(s.WIN="win",s.LOSE="lose",s.DRAW="draw",s))(O||{});const ee={class:"game-board"},te={class:"choices-container"},se=["onClick","disabled"],ne={class:"choice-emoji"},ae={class:"choice-label"},oe={key:0,class:"result-section"},le={class:"result-display"},ie={class:"result-emoji"},re={class:"result-text"},ce={class:"choices-comparison"},ue={class:"comparison-item"},de={class:"comparison-emoji"},me={class:"comparison-item"},pe={class:"comparison-emoji"},fe={class:"auto-reset-hint"},he=2e3,ve=x({__name:"RPSGameBoard",props:{isPlaying:{type:Boolean},playerChoice:{},computerChoice:{},currentResult:{}},emits:["play","play-again"],setup(s,{emit:S}){const c=s,v=S,m=w(0);let h=null;const p=w("自动进入下一局...");function n(){let l=Math.ceil(he/1e3);m.value=l,h=window.setInterval(()=>{l--,m.value=l,l<=0&&u()},1e3)}function u(){h!==null&&(clearInterval(h),h=null),m.value=0}j(()=>c.currentResult,l=>{l!==null?n():u()}),j(m,l=>{l>0?p.value=`${l}秒后自动进入下一局`:p.value="即将开始新局..."}),M(()=>{u()});const C=[{value:r.ROCK,...$.rock},{value:r.PAPER,...$.paper},{value:r.SCISSORS,...$.scissors}];function t(l){return c.playerChoice===l}function a(l){!c.isPlaying&&!c.currentResult&&v("play",l)}function i(){return c.currentResult&&G[c.currentResult]?.emoji||""}function d(){return c.currentResult&&G[c.currentResult]?.label||""}function f(l){return l&&$[l]?.emoji||""}function o(){v("play-again")}return(l,y)=>(P(),A("div",ee,[y[3]||(y[3]=e("div",{class:"game-info"},[e("h2",{class:"game-title"},"石头 剪刀 布"),e("p",{class:"game-subtitle"},"选择你的出招")],-1)),e("div",te,[(P(),A(V,null,q(C,b=>e("button",{key:b.value,class:U(["choice-button",{"choice-button--active":t(b.value)}]),onClick:R=>a(b.value),disabled:s.isPlaying},[e("span",ne,g(b.emoji),1),e("span",ae,g(b.label),1)],10,se)),64))]),s.currentResult?(P(),A("div",oe,[e("div",le,[e("span",ie,g(i()),1),e("span",re,g(d()),1)]),e("div",ce,[e("div",ue,[y[0]||(y[0]=e("span",{class:"comparison-label"},"你",-1)),e("span",de,g(f(s.playerChoice)),1)]),y[2]||(y[2]=e("span",{class:"vs-text"},"VS",-1)),e("div",me,[y[1]||(y[1]=e("span",{class:"comparison-label"},"电脑",-1)),e("span",pe,g(f(s.computerChoice)),1)])]),e("p",fe,g(p.value),1),e("button",{class:"play-again-button",onClick:o}," 立即开始 ")])):F("",!0)]))}}),Ce=B(ve,[["__scopeId","data-v-0c404146"]]),ye={class:"score-board"},Se={class:"score-stats"},ge={class:"stat-item"},Re={class:"stat-value"},_e={class:"stat-item stat-item--win"},we={class:"stat-value"},be={class:"stat-item stat-item--lose"},Pe={class:"stat-value"},Ae={class:"stat-item stat-item--draw"},Ee={class:"stat-value"},Oe={class:"win-rate"},$e={class:"win-rate-bar"},Ie={class:"win-rate-value"},We={key:0,class:"history-section"},ke={class:"history-list"},Te={class:"history-choices"},Me={class:"history-choice"},Ge={class:"history-choice"},xe=x({__name:"RPSScoreBoard",props:{totalGames:{},playerWins:{},computerWins:{},drawCount:{},playerWinRate:{},gameHistory:{}},emits:["reset"],setup(s,{emit:S}){const c=S;function v(){c("reset")}function m(p){return $[p].label}function h(p){return G[p].label}return(p,n)=>(P(),A("div",ye,[e("div",{class:"score-header"},[n[1]||(n[1]=e("h3",{class:"score-title"},"游戏统计",-1)),e("button",{class:"reset-button",onClick:v,"aria-label":"重置统计"},[...n[0]||(n[0]=[e("span",{class:"reset-icon"},"↺",-1)])])]),e("div",Se,[e("div",ge,[n[2]||(n[2]=e("span",{class:"stat-label"},"总场次",-1)),e("span",Re,g(s.totalGames),1)]),e("div",_e,[n[3]||(n[3]=e("span",{class:"stat-label"},"胜利",-1)),e("span",we,g(s.playerWins),1)]),e("div",be,[n[4]||(n[4]=e("span",{class:"stat-label"},"失败",-1)),e("span",Pe,g(s.computerWins),1)]),e("div",Ae,[n[5]||(n[5]=e("span",{class:"stat-label"},"平局",-1)),e("span",Ee,g(s.drawCount),1)])]),e("div",Oe,[n[6]||(n[6]=e("span",{class:"win-rate-label"},"胜率",-1)),e("div",$e,[e("div",{class:"win-rate-fill",style:Y({width:`${s.playerWinRate}%`})},null,4)]),e("span",Ie,g(s.playerWinRate)+"%",1)]),s.gameHistory.length>0?(P(),A("div",We,[n[8]||(n[8]=e("h4",{class:"history-title"},"历史记录",-1)),e("ul",ke,[(P(!0),A(V,null,q(s.gameHistory,(u,C)=>(P(),A("li",{key:C,class:"history-item"},[e("div",Te,[e("span",Me,g(m(u.playerChoice)),1),n[7]||(n[7]=e("span",{class:"history-separator"},"vs",-1)),e("span",Ge,g(m(u.computerChoice)),1)]),e("span",{class:U(["history-result",`history-result--${u.result}`])},g(h(u.result)),3)]))),128))])])):F("",!0)]))}}),Be=B(xe,[["__scopeId","data-v-1f1e62eb"]]),Le=z("game",()=>{const s=w(null),S=w(null),c=w(null),v=w(!1),m=w(0),h=w(0),p=w(0),n=w([]),u=D(()=>m.value+h.value+p.value),C=D(()=>u.value===0?0:Math.round(m.value/u.value*100));function t(){v.value=!0,s.value=null,S.value=null,c.value=null}function a(R){s.value=R}function i(R){S.value=R}function d(R){c.value=R}function f(R){R==="win"?m.value++:R==="lose"?h.value++:p.value++}function o(R){n.value.unshift(R),n.value.length>H&&(n.value=n.value.slice(0,H))}function l(){v.value=!1}function y(){s.value=null,S.value=null,c.value=null,v.value=!1}function b(){m.value=0,h.value=0,p.value=0,n.value=[],y()}return{playerChoice:s,computerChoice:S,currentResult:c,isPlaying:v,playerWins:m,computerWins:h,drawCount:p,gameHistory:n,totalGames:u,playerWinRate:C,startGame:t,setPlayerChoice:a,setComputerChoice:i,setCurrentResult:d,updateScore:f,addHistory:o,endGame:l,resetGame:y,resetAllStats:b}});function Ke(){function s(t){const a=new Map;return a.set(r.ROCK,0),a.set(r.PAPER,0),a.set(r.SCISSORS,0),t.forEach(i=>{const d=a.get(i.playerChoice)||0;a.set(i.playerChoice,d+1)}),a}function S(t){const a=new Map;[r.ROCK,r.PAPER,r.SCISSORS].forEach(i=>{const d=new Map;d.set(r.ROCK,0),d.set(r.PAPER,0),d.set(r.SCISSORS,0),a.set(i,d)});for(let i=0;i<t.length-1;i++){const d=t[i].playerChoice,f=t[i+1].playerChoice,o=a.get(d);if(o){const l=o.get(f)||0;o.set(f,l+1)}}return a}function c(t){if(t.length<3)return null;const a=s(t),i=t[0].playerChoice;let d=0,f=null;if(a.forEach((o,l)=>{l!==i&&o>d&&(d=o,f=l)}),!f){const o=["rock","paper","scissors"];return o[Math.floor(Math.random()*o.length)]}return f}function v(t){if(t.length<2)return null;const a=S(t),i=t[0].playerChoice,d=a.get(i);if(!d)return null;let f=0,o=null;return d.forEach((l,y)=>{l>f&&(f=l,o=y)}),!o||f===0?c(t):o}function m(t){if(t.length<6)return null;const a=t.slice(0,3).map(i=>i.playerChoice);for(let i=3;i<t.length-2;i++){const d=t.slice(i,i+3).map(f=>f.playerChoice);if(h(a,d)&&i+3<t.length)return t[i+3].playerChoice}return null}function h(t,a){return t[0]===a[0]&&t[1]===a[1]&&t[2]===a[2]}function p(t){return{[r.ROCK]:r.SCISSORS,[r.PAPER]:r.ROCK,[r.SCISSORS]:r.PAPER}[t]}function n(){const t=[r.ROCK,r.PAPER,r.SCISSORS];return t[Math.floor(Math.random()*t.length)]}function u(t){if(t.length<2)return n();let a=null;return a=m(t),a||(a=v(t)),a||(a=c(t)),a?p(a):n()}function C(t){return t.length<2?"random":m(t)?"pattern":v(t)?"markov":c(t)?"frequency":"random"}return{getAIChoice:u,getStrategyType:C,calculateFrequencies:s,buildTransitionMatrix:S}}function je(){const s=Le(),{getAIChoice:S}=Ke();function c(){return S(s.gameHistory)}function v(n,u){return n===u?O.DRAW:{[r.ROCK]:r.SCISSORS,[r.PAPER]:r.ROCK,[r.SCISSORS]:r.PAPER}[n]===u?O.WIN:O.LOSE}function m(n){s.startGame(),s.setPlayerChoice(n),I.play(W.CLICK);const u=c();s.setComputerChoice(u);const C=v(n,u);s.setCurrentResult(C),C===O.WIN?(I.play(W.WIN),k.vibrate(T.WIN)):C===O.LOSE?(I.play(W.LOSE),k.vibrate(T.LOSE)):(I.play(W.DRAW),k.vibrate(T.DRAW)),s.updateScore(C);const t={playerChoice:n,computerChoice:u,result:C,timestamp:Date.now()};s.addHistory(t),s.endGame()}function h(){s.resetGame()}function p(){s.resetAllStats()}return{...X(s),playRound:m,resetGame:h,resetAllStats:p}}const De={class:"game-view"},He={class:"container"},Ne={class:"game-layout"},Ve={class:"game-main"},qe={class:"game-sidebar"},Fe=2e3,Ue=x({__name:"GameView",setup(s){const S=Z(),{isPlaying:c,playerChoice:v,computerChoice:m,currentResult:h,playerWins:p,computerWins:n,drawCount:u,gameHistory:C,totalGames:t,playerWinRate:a,playRound:i,resetGame:d,resetAllStats:f}=je();let o=null;function l(E){o!==null&&clearTimeout(o),i(E)}function y(){o!==null&&(clearTimeout(o),o=null),f()}function b(){o!==null&&(clearTimeout(o),o=null),d()}function R(){S.push("/")}return J(()=>{h.value!==null&&(o!==null&&clearTimeout(o),o=window.setTimeout(()=>{d(),o=null},Fe))}),M(()=>{o!==null&&clearTimeout(o)}),Q(()=>{const E=new BroadcastChannel("woodcat-games");E.onmessage=L=>{const K=L.data;K.type==="close-game"&&K.gameRoute!=="/game/rock-paper-scissors"&&(E.close(),window.close())},M(()=>{E.close()})}),(E,L)=>(P(),A("div",De,[e("div",He,[e("div",{class:"game-header"},[e("button",{onClick:R,class:"back-button"},"← 返回首页")]),e("div",Ne,[e("div",Ve,[N(Ce,{"is-playing":_(c),"player-choice":_(v),"computer-choice":_(m),"current-result":_(h),onPlay:l,onPlayAgain:b},null,8,["is-playing","player-choice","computer-choice","current-result"])]),e("div",qe,[N(Be,{"total-games":_(t),"player-wins":_(p),"computer-wins":_(n),"draw-count":_(u),"player-win-rate":_(a),"game-history":_(C),onReset:y},null,8,["total-games","player-wins","computer-wins","draw-count","player-win-rate","game-history"])])])])]))}}),Xe=B(Ue,[["__scopeId","data-v-9df5750d"]]);export{Xe as default};
