import{b as w,j as R,d as O,o as P,c as p,F as x,a as e,t as B,u as i,r as D,h as j,n as F,f as z,_ as U,m as J,e as Q,p as q,q as X,s as ee}from"./index-Crvd5xHI.js";const k=15;var l=(t=>(t[t.EMPTY=0]="EMPTY",t[t.BLACK=1]="BLACK",t[t.WHITE=2]="WHITE",t))(l||{}),g=(t=>(t.PLAYING="playing",t.BLACK_WINS="black_wins",t.WHITE_WINS="white_wins",t.DRAW="draw",t))(g||{}),f=(t=>(t.PVP="pvp",t.PVE="pve",t))(f||{});function Z(){const t=w([]),s=w(l.BLACK),a=w(g.PLAYING),h=w(f.PVP),r=w(null),I=w(0),W=w(0),y=w(!1),V=R(()=>a.value===g.BLACK_WINS?"é»‘å­èŽ·èƒœï¼":a.value===g.WHITE_WINS?"ç™½å­èŽ·èƒœï¼":a.value===g.DRAW?"å¹³å±€ï¼":h.value===f.PVE?s.value===r.value?"AIæ€è€ƒä¸­...":"ä½ çš„å›žåˆ":s.value===l.BLACK?"é»‘å­å›žåˆ":"ç™½å­å›žåˆ");function $(o,m,L){let _=0;const d=[[[0,1],[0,-1]],[[1,0],[-1,0]],[[1,1],[-1,-1]],[[1,-1],[-1,1]]];for(const c of d){let u=0,A=0;for(const[E,M]of c){let Y=o+E,H=m+M;for(;Y>=0&&Y<k&&H>=0&&H<k;){if(t.value[Y][H]===L)u++;else{if(t.value[Y][H]===l.EMPTY)break;A++;break}Y+=E,H+=M}}u>=4?_+=1e5:u===3?A===0?_+=1e4:A===1&&(_+=1e3):u===2?A===0?_+=1e3:A===1&&(_+=100):u===1&&(A===0?_+=100:A===1&&(_+=10))}return _}function S(){if(!r.value)return null;const o=r.value,m=o===l.BLACK?l.WHITE:l.BLACK;let L=-1/0,_=null;for(let d=0;d<k;d++)for(let c=0;c<k;c++)if(t.value[d][c]===l.EMPTY){const u=$(d,c,o),A=$(d,c,m),E=Math.max(u,A*1.1);E>L&&(L=E,_={row:d,col:c})}if(_===null||L<100){const d=Math.floor(k/2);for(let c=d-2;c<=d+2;c++)for(let u=d-2;u<=d+2;u++)if(c>=0&&c<k&&u>=0&&u<k&&t.value[c][u]===l.EMPTY)return{row:c,col:u}}return _}function N(){if(console.log("aiMove called",{gameState:a.value,currentPlayer:s.value,aiPlayer:r.value,gameMode:h.value,isAIThinking:y.value}),a.value!==g.PLAYING||s.value!==r.value){console.log("aiMove returned early");return}y.value=!0,setTimeout(()=>{const o=S();console.log("AI move result",o),o?(y.value=!1,C(o.row,o.col)):y.value=!1},500)}function b(){t.value=[];for(let o=0;o<k;o++)t.value.push(new Array(k).fill(l.EMPTY))}function n(o,m,L){const _=[[[0,1],[0,-1]],[[1,0],[-1,0]],[[1,1],[-1,-1]],[[1,-1],[-1,1]]];for(const d of _){let c=1;for(const[u,A]of d){let E=o+u,M=m+A;for(;E>=0&&E<k&&M>=0&&M<k&&t.value[E][M]===L;)c++,E+=u,M+=A}if(c>=5)return!0}return!1}function v(){for(let o=0;o<k;o++)for(let m=0;m<k;m++)if(t.value[o][m]===l.EMPTY)return!1;return!0}function C(o,m){return console.log("placePiece called",{row:o,col:m,currentPlayer:s.value,gameMode:h.value,aiPlayer:r.value}),a.value!==g.PLAYING?(console.log("placePiece: game not playing"),!1):t.value[o][m]!==l.EMPTY?(console.log("placePiece: position not empty"),!1):h.value===f.PVE&&s.value===r.value?(console.log("placePiece: AI turn, player cannot move"),!1):y.value?(console.log("placePiece: AI is thinking"),!1):(t.value[o][m]=s.value,n(o,m,s.value)?(a.value=s.value===l.BLACK?g.BLACK_WINS:g.WHITE_WINS,a.value===g.BLACK_WINS?I.value++:W.value++,!0):v()?(a.value=g.DRAW,!0):(s.value=s.value===l.BLACK?l.WHITE:l.BLACK,console.log("placePiece: switched player",{newCurrentPlayer:s.value,aiPlayer:r.value}),h.value===f.PVE&&s.value===r.value&&(console.log("placePiece: triggering AI move"),N()),!0))}function T(){if(console.log("startNewGame called",{gameMode:h.value}),b(),a.value=g.PLAYING,y.value=!1,s.value=l.BLACK,h.value===f.PVE){const o=Math.random()<.5;console.log("startNewGame: assigning colors",{aiIsBlack:o}),o?(r.value=l.BLACK,setTimeout(()=>{console.log("startNewGame: triggering AI first move"),N()},300)):r.value=l.WHITE}else r.value=null;console.log("startNewGame completed",{currentPlayer:s.value,aiPlayer:r.value})}function G(o){h.value=o,T()}function K(){I.value=0,W.value=0,T()}return{board:t,currentPlayer:s,gameState:a,gameMode:h,aiPlayer:r,blackWins:I,whiteWins:W,isAIThinking:y,statusText:V,placePiece:C,startNewGame:T,setGameMode:G,resetAllStats:K}}const te={class:"gomoku-game"},oe={class:"game-header"},se={class:"score-info"},le={class:"score-item"},ae={class:"score-value"},ne={class:"score-item"},ie={class:"score-value"},re={class:"status-text"},ce={class:"game-board"},ue={class:"board-container"},ve={class:"board"},de={class:"grid-lines"},fe=["onClick"],me={key:0,class:"game-over-overlay"},_e={class:"game-over-content"},ge={class:"game-over-icon"},Pe={class:"game-over-title"},pe=O({__name:"GomokuBoard",setup(t){const{board:s,gameState:a,blackWins:h,whiteWins:r,statusText:I,placePiece:W,startNewGame:y,resetAllStats:V}=Z();function $(n,v){return{left:`${3+v/14*94}%`,top:`${3+n/14*94}%`,transform:"translate(-50%, -50%)"}}function S(n,v){W(n,v)}function N(){y()}function b(){V()}return(n,v)=>(P(),p(x,null,[e("div",te,[e("div",oe,[e("div",se,[e("div",le,[v[0]||(v[0]=e("span",{class:"score-label"},"é»‘å­",-1)),e("span",ae,B(i(h)),1)]),e("div",ne,[v[1]||(v[1]=e("span",{class:"score-label"},"ç™½å­",-1)),e("span",ie,B(i(r)),1)])]),e("div",re,B(i(I)),1)]),e("div",ce,[e("div",ue,[e("div",ve,[e("div",de,[(P(),p(x,null,D(15,C=>e("div",{key:`h-${C}`,class:"grid-line grid-line-horizontal",style:j({top:`${(C-1)/14*100}%`})},null,4)),64)),(P(),p(x,null,D(15,C=>e("div",{key:`v-${C}`,class:"grid-line grid-line-vertical",style:j({left:`${(C-1)/14*100}%`})},null,4)),64))]),(P(!0),p(x,null,D(i(s),(C,T)=>(P(),p("div",{key:`row-${T}`},[(P(!0),p(x,null,D(C,(G,K)=>(P(),p("div",{key:`cell-${T}-${K}`,class:"intersection",style:j($(T,K)),onClick:o=>S(T,K)},[G!==i(l).EMPTY?(P(),p("div",{key:0,class:F(["stone",{"stone-black":G===i(l).BLACK,"stone-white":G===i(l).WHITE}])},null,2)):z("",!0)],12,fe))),128))]))),128))])])])]),i(a)!==i(g).PLAYING?(P(),p("div",me,[e("div",_e,[e("div",ge,B(i(a)===i(g).DRAW?"ðŸ¤":"ðŸŽ‰"),1),e("div",Pe,B(i(I)),1),e("div",{class:"game-over-buttons"},[e("button",{class:"new-game-button",onClick:N}," æ–°æ¸¸æˆ "),e("button",{class:"reset-all-button",onClick:b}," é‡ç½®ç»Ÿè®¡ ")])])])):z("",!0)],64))}}),he=U(pe,[["__scopeId","data-v-01c4c6c0"]]),ke={class:"gomoku-view"},Ae={class:"container"},ye={key:0,class:"mode-selector"},Ie={class:"mode-selector-content"},be={class:"mode-buttons"},Ce={key:0,class:"first-player-info"},Ee={class:"first-player-text"},we={key:1,class:"game-layout"},Te={class:"game-main"},Be={key:0,class:"color-hint-overlay"},We={class:"color-hint-content"},$e={class:"color-hint-icon"},Le={class:"color-hint-text"},Me=O({__name:"GomokuView",setup(t){const{gameMode:s,aiPlayer:a,startNewGame:h}=Z(),r=w(!1),I=w(!1),W=R(()=>s.value!==f.PVE||!a.value?"é»‘å­å…ˆæ‰‹":a.value===l.BLACK?"AIå…ˆæ‰‹ï¼ˆé»‘å­ï¼‰":"ä½ å…ˆæ‰‹ï¼ˆé»‘å­ï¼‰"),y=R(()=>s.value!==f.PVE||!a.value||a.value===l.WHITE?"âš«":"âšª"),V=R(()=>s.value!==f.PVE||!a.value?"åŒäººå¯¹æˆ˜æ¨¡å¼":a.value===l.WHITE?"ä½ æ‰§é»‘æ£‹ï¼ˆå…ˆæ‰‹ï¼‰":"ä½ æ‰§ç™½æ£‹ï¼ˆåŽæ‰‹ï¼‰");function $(b){s.value=b}function S(){r.value=!0,h(),s.value===f.PVE&&(I.value=!0,setTimeout(()=>{I.value=!1},3e3))}function N(){window.close()}return J(()=>{const b=new BroadcastChannel("woodcat-games");b.onmessage=n=>{const v=n.data;v.type==="close-game"&&v.gameRoute!=="/game/gomoku"&&(b.close(),window.close())},Q(()=>{b.close()})}),(b,n)=>(P(),p("div",ke,[e("div",Ae,[e("div",{class:"game-header"},[e("button",{onClick:N,class:"back-button"},"â† è¿”å›žé¦–é¡µ")]),r.value?(P(),p("div",we,[e("div",Te,[q(he)])])):(P(),p("div",ye,[e("div",Ie,[n[5]||(n[5]=e("div",{class:"mode-selector-title"},"é€‰æ‹©æ¸¸æˆæ¨¡å¼",-1)),e("div",be,[e("button",{class:F(["mode-button",{"mode-button--active":i(s)===i(f).PVP}]),onClick:n[0]||(n[0]=v=>$(i(f).PVP))},[...n[2]||(n[2]=[e("div",{class:"mode-icon"},"ðŸ‘¥",-1),e("div",{class:"mode-name"},"åŒäººå¯¹æˆ˜",-1),e("div",{class:"mode-desc"},"ä¸¤ä¸ªçŽ©å®¶è½®æµä¸‹æ£‹",-1)])],2),e("button",{class:F(["mode-button",{"mode-button--active":i(s)===i(f).PVE}]),onClick:n[1]||(n[1]=v=>$(i(f).PVE))},[...n[3]||(n[3]=[e("div",{class:"mode-icon"},"ðŸ¤–",-1),e("div",{class:"mode-name"},"äººæœºå¯¹æˆ˜",-1),e("div",{class:"mode-desc"},"ä¸ŽAIå¯¹æˆ˜ï¼ŒæŒ‘æˆ˜æ™ºèƒ½AI",-1)])],2)]),i(s)===i(f).PVE?(P(),p("div",Ce,[n[4]||(n[4]=e("div",{class:"first-player-icon"},"ðŸŽ²",-1)),e("div",Ee,B(W.value),1)])):z("",!0),e("button",{class:"start-game-button",onClick:S}," å¼€å§‹æ¸¸æˆ ")])])),q(ee,{name:"fade"},{default:X(()=>[I.value?(P(),p("div",Be,[e("div",We,[e("div",$e,B(y.value),1),e("div",Le,B(V.value),1)])])):z("",!0)]),_:1})])]))}}),Ve=U(Me,[["__scopeId","data-v-b332bb66"]]);export{Ve as default};
