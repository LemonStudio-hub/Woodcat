import{w as Q,e as P,f as B,k as X,b as _,d as Z,o as p,c as y,a,t as R,u as h,F as N,r as L,i as E,n as Y,g as V,_ as j,p as ee,q as ae}from"./index-CWkIdGNN.js";import{H as A}from"./hammer-BRjDnnGP.js";import{p as H}from"./persistenceService-D2TLTx3Y.js";import{a as D,S as U,v as W,V as q}from"./vibrationService-DXRESRMj.js";const I=20,K=3,F=150;var i=(s=>(s.UP="up",s.DOWN="down",s.LEFT="left",s.RIGHT="right",s))(i||{});const te={up:"down",down:"up",left:"right",right:"left"};function se(){const s=_([]),u=_({x:0,y:0}),c=_(i.RIGHT),o=_(i.RIGHT),l=_(!1),n=_(!1),f=_(0),S=_(0);function z(){const e={snake:s.value,food:u.value,direction:c.value,gameOver:n.value};H.saveSnakeGame({stats:{score:f.value,bestScore:S.value},gameState:e})}function G(){const e=H.loadSnakeGame();f.value=e.stats.score,S.value=e.stats.bestScore,e.gameState?(s.value=e.gameState.snake,u.value=e.gameState.food,c.value=e.gameState.direction,o.value=e.gameState.direction,n.value=e.gameState.gameOver,n.value||(l.value=!0,t&&clearInterval(t),t=window.setInterval(b,F))):(x(),w())}function k(){const e=H.loadSnakeGame();H.saveSnakeGame({stats:e.stats,gameState:null})}Q([f,S,s,u,c,n],()=>{l.value&&!n.value&&z()},{deep:!0}),G();let t=null;const v=X(()=>n.value?"æ¸¸æˆç»“æŸ":l.value?"æ¸¸æˆä¸­...":"æŒ‰æ–¹å‘é”®å¼€å§‹");function w(){let e,r;do e={x:Math.floor(Math.random()*I),y:Math.floor(Math.random()*I)},r=!s.value.some(M=>M.x===e.x&&M.y===e.y);while(!r);u.value=e}function x(){s.value=[];for(let e=0;e<K;e++)s.value.push({x:K-1-e,y:Math.floor(I/2)})}function C(){c.value=o.value;const r={...s.value[0]};switch(c.value){case i.UP:r.y-=1;break;case i.DOWN:r.y+=1;break;case i.LEFT:r.x-=1;break;case i.RIGHT:r.x+=1;break}if(O(r)){m();return}s.value.unshift(r),r.x===u.value.x&&r.y===u.value.y?(f.value+=10,w(),D.play(U.EAT),W.vibrate(q.EAT)):s.value.pop()}function O(e){return e.x<0||e.x>=I||e.y<0||e.y>=I?!0:s.value.some(r=>r.x===e.x&&r.y===e.y)}function b(){l.value&&!n.value&&C()}function T(){l.value=!0,n.value=!1,f.value=0,c.value=i.RIGHT,o.value=i.RIGHT,x(),w(),t&&clearInterval(t),t=window.setInterval(b,F)}function g(){l.value=!1,t&&(clearInterval(t),t=null)}function d(){n.value||(l.value=!0,t&&clearInterval(t),t=window.setInterval(b,F))}function m(){l.value=!1,n.value=!0,D.play(U.CRASH),W.vibrate(q.CRASH),t&&(clearInterval(t),t=null),f.value>S.value&&(S.value=f.value)}function $(){T(),k()}function J(e){te[e]!==c.value&&(o.value=e)}return P(()=>{t&&clearInterval(t)}),B(()=>{t&&clearInterval(t)}),{snake:s,food:u,isPlaying:l,isGameOver:n,score:f,bestScore:S,statusText:v,startGame:T,pauseGame:g,continueGame:d,restartGame:$,changeDirection:J,loadGameState:G,clearGameState:k}}const ne={class:"snake-game"},oe={class:"game-header"},le={class:"score-info"},re={class:"score-item"},ie={class:"score-value"},ce={class:"score-item"},ue={class:"score-value"},ve={class:"status-text"},de={class:"game-board"},fe={class:"board"},me={class:"grid-lines"},_e={key:0,class:"start-overlay"},Se={key:0,class:"game-over-overlay"},ge={class:"game-over-content"},he={class:"game-over-score"},pe=Z({__name:"SnakeBoard",setup(s){const{snake:u,food:c,isPlaying:o,isGameOver:l,score:n,bestScore:f,statusText:S,startGame:z,restartGame:G,changeDirection:k}=se(),t=_(null);let v=null;function w(g){return{left:`${g.x*5}%`,top:`${g.y*5}%`,width:"5%",height:"5%"}}function x(){return{left:`${c.value.x*5}%`,top:`${c.value.y*5}%`,width:"5%",height:"5%"}}function C(){z()}function O(){G()}function b(){if(!t.value)return;v=new A.Manager(t.value);const g=new A.Swipe({direction:A.DIRECTION_ALL,threshold:30});v.add(g),v.on("swipeup",()=>{o.value&&k(i.UP)}),v.on("swipedown",()=>{o.value&&k(i.DOWN)}),v.on("swipeleft",()=>{o.value&&k(i.LEFT)}),v.on("swiperight",()=>{o.value&&k(i.RIGHT)})}function T(){v&&(v.destroy(),v=null)}return P(()=>{b()}),B(()=>{T()}),(g,d)=>(p(),y("div",ne,[a("div",oe,[a("div",le,[a("div",re,[d[0]||(d[0]=a("span",{class:"score-label"},"åˆ†æ•°",-1)),a("span",ie,R(h(n)),1)]),a("div",ce,[d[1]||(d[1]=a("span",{class:"score-label"},"æœ€é«˜åˆ†",-1)),a("span",ue,R(h(f)),1)])]),a("div",ve,R(h(S)),1)]),a("div",de,[a("div",{class:"board-container",ref_key:"boardRef",ref:t},[a("div",fe,[a("div",me,[(p(),y(N,null,L(20,m=>a("div",{key:`h-${m}`,class:"grid-line grid-line-horizontal",style:E({top:`${(m-1)*5}%`})},null,4)),64)),(p(),y(N,null,L(20,m=>a("div",{key:`v-${m}`,class:"grid-line grid-line-vertical",style:E({left:`${(m-1)*5}%`})},null,4)),64))]),(p(!0),y(N,null,L(h(u),(m,$)=>(p(),y("div",{key:`snake-${$}`,class:Y(["snake-segment",{"snake-head":$===0}]),style:E(w(m))},null,6))),128)),a("div",{class:"food",style:E(x())},null,4),!h(o)&&!h(l)?(p(),y("div",_e,[a("button",{class:"start-button",onClick:C}," å¼€å§‹æ¸¸æˆ ")])):V("",!0)])],512)]),h(l)?(p(),y("div",Se,[a("div",ge,[d[2]||(d[2]=a("div",{class:"game-over-icon"},"ğŸ’€",-1)),d[3]||(d[3]=a("div",{class:"game-over-title"},"æ¸¸æˆç»“æŸ",-1)),a("div",he,"å¾—åˆ†ï¼š"+R(h(n)),1),a("button",{class:"restart-button",onClick:O}," é‡æ–°å¼€å§‹ ")])])):V("",!0)]))}}),ye=j(pe,[["__scopeId","data-v-a7c65fbe"]]),ke={class:"snake-view"},we={class:"container"},be={class:"game-layout"},Ie={class:"game-main"},Ge=Z({__name:"SnakeView",setup(s){const u=ae();function c(){u.push("/")}return P(()=>{const o=new BroadcastChannel("woodcat-games");o.onmessage=l=>{const n=l.data;n.type==="close-game"&&n.gameRoute!=="/game/snake"&&(o.close(),window.close())},B(()=>{o.close()})}),(o,l)=>(p(),y("div",ke,[a("div",we,[a("div",{class:"game-header"},[a("button",{onClick:c,class:"back-button"},"â† è¿”å›é¦–é¡µ")]),a("div",be,[a("div",Ie,[ee(ye)])])])]))}}),Ee=j(Ge,[["__scopeId","data-v-a9e88e7b"]]);export{Ee as default};
