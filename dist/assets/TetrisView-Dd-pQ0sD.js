import{b as O,w as ae,k as se,d as j,e as Q,f as ee,o as P,c as R,F as W,a as u,t as D,u as S,r as Z,i as ne,x as oe,g as re,_ as te,p as le,q as ie}from"./index-CWkIdGNN.js";import{H as X}from"./hammer-BRjDnnGP.js";import{p as T}from"./persistenceService-D2TLTx3Y.js";import{a as w,S as A,v as V,V as k}from"./vibrationService-DXRESRMj.js";const Y=10,B=20;var g=(t=>(t[t.EMPTY=0]="EMPTY",t[t.I=1]="I",t[t.O=2]="O",t[t.T=3]="T",t[t.S=4]="S",t[t.Z=5]="Z",t[t.J=6]="J",t[t.L=7]="L",t))(g||{}),l=(t=>(t.PLAYING="playing",t.GAME_OVER="gameOver",t))(l||{});const ce={1:[[1,1,1,1]],2:[[1,1],[1,1]],3:[[0,1,0],[1,1,1]],4:[[0,1,1],[1,1,0]],5:[[1,1,0],[0,1,1]],6:[[1,0,0],[1,1,1]],7:[[0,0,1],[1,1,1]],0:[]},q={0:"#ffffff",1:"#000000",2:"#1a1a1a",3:"#333333",4:"#4d4d4d",5:"#666666",6:"#808080",7:"#999999"},z=[1,2,3,4,5,6,7],ue=1e3;function ve(){const t=O([]),v=O(l.PLAYING),i=O(0),p=O(0),s=O(null);let d=null;function M(){const e=T.loadTetrisGame();p.value=e.stats.highScore,b()}function G(){const e=T.loadTetrisGame();T.saveTetrisGame({stats:e.stats,gameState:null})}ae([i,p],()=>{i.value>p.value&&(p.value=i.value);const e=T.loadTetrisGame();T.saveTetrisGame({stats:{highScore:p.value},gameState:e.gameState})}),M();const I=se(()=>v.value===l.GAME_OVER?`Ê∏∏ÊàèÁªìÊùüÔºÅÂæóÂàÜÔºö${i.value}`:`ÂæóÂàÜÔºö${i.value}`);function b(){t.value=[];for(let e=0;e<B;e++)t.value.push(new Array(Y).fill(g.EMPTY))}function $(){const e=Math.floor(Math.random()*z.length);return z[e]}function L(){const e=$(),a=ce[e],r=Math.floor((Y-a[0].length)/2);return{type:e,x:r,y:0,shape:a}}function _(e,a=0,r=0){const n=e.shape;for(let c=0;c<n.length;c++)for(let m=0;m<n[c].length;m++)if(n[c][m]!==g.EMPTY){const J=e.x+m+a,U=e.y+c+r;if(J<0||J>=Y||U>=B||U>=0&&t.value[U][J]!==g.EMPTY)return!0}return!1}function y(e){const a=e.shape;for(let r=0;r<a.length;r++)for(let n=0;n<a[r].length;n++)if(a[r][n]!==g.EMPTY){const c=e.x+n,m=e.y+r;m>=0&&m<B&&c>=0&&c<Y&&(t.value[m][c]=e.type)}}function C(){let e=0;for(let a=B-1;a>=0;a--)t.value[a].every(n=>n!==g.EMPTY)&&(t.value.splice(a,1),t.value.unshift(new Array(Y).fill(g.EMPTY)),e++,a++);e>0&&(i.value+=e*100,w.play(A.CLEAR),V.vibrate(k.CLEAR))}function x(){return t.value[0].some(e=>e!==g.EMPTY)}function H(e){const a=e.length,r=e[0].length,n=[];for(let c=0;c<r;c++){n[c]=[];for(let m=a-1;m>=0;m--)n[c].push(e[m][c])}return n}function F(){if(!(!s.value||v.value!==l.PLAYING))if(!_(s.value,0,1))s.value.y++;else{if(y(s.value),C(),x()){v.value=l.GAME_OVER,h(),w.play(A.GAME_OVER),V.vibrate(k.GAME_OVER);return}s.value=L(),_(s.value)&&(v.value=l.GAME_OVER,h())}}function K(e){!s.value||v.value!==l.PLAYING||_(s.value,e,0)||(s.value.x+=e)}function N(){if(!s.value||v.value!==l.PLAYING)return;const e=H(s.value.shape),a={...s.value,shape:e};_(a)?_(a,1,0)?_(a,-1,0)||(s.value={...a,x:a.x-1},w.play(A.ROTATE)):(s.value={...a,x:a.x+1},w.play(A.ROTATE)):(s.value=a,w.play(A.ROTATE),V.vibrate(k.ROTATE))}function o(){if(!(!s.value||v.value!==l.PLAYING)){for(;!_(s.value,0,1);)s.value.y++;if(w.play(A.DROP),V.vibrate(k.DROP),y(s.value),C(),x()){v.value=l.GAME_OVER,w.play(A.GAME_OVER),h();return}s.value=L(),_(s.value)&&(v.value=l.GAME_OVER,w.play(A.GAME_OVER),h())}}function f(){b(),v.value=l.PLAYING,i.value=0,s.value=L(),d&&clearInterval(d),d=window.setInterval(F,ue)}function h(){d&&(clearInterval(d),d=null)}function E(){h(),f(),G()}return{board:t,gameState:v,score:i,highScore:p,currentBlock:s,statusText:I,moveBlock:K,rotateBlock:N,hardDrop:o,startGame:f,restartGame:E,loadGameState:M,clearGameState:G}}const de={class:"tetris-game"},fe={class:"game-header"},me={class:"status-text"},pe={class:"high-score-text"},_e={class:"game-board"},he={class:"board-container"},ge={key:0,class:"game-over-overlay"},Ee={class:"game-over-content"},we={class:"game-over-score"},Ae=30,Ge=j({__name:"TetrisBoard",setup(t){const{board:v,gameState:i,score:p,highScore:s,currentBlock:d,statusText:M,moveBlock:G,rotateBlock:I,hardDrop:b,startGame:$,restartGame:L}=ve(),_=O(null);let y=null;function C(o,f){if(d.value){const E=d.value.shape,e=d.value.x,a=d.value.y;for(let r=0;r<E.length;r++)for(let n=0;n<E[r].length;n++)if(E[r][n]!==g.EMPTY){const c=a+r,m=e+n;if(c===o&&m===f)return{backgroundColor:q[d.value.type]}}}const h=v.value[o][f];return h!==g.EMPTY?{backgroundColor:q[h]}:{backgroundColor:"var(--color-white)"}}function x(o,f){return""}function H(){if(!_.value)return;const o=new X.Manager(_.value);y=o;const f=new X.Swipe({direction:X.DIRECTION_ALL,threshold:Ae});o.add(f),o.on("swipeleft",()=>{i.value===l.PLAYING&&G(-1)}),o.on("swiperight",()=>{i.value===l.PLAYING&&G(1)}),o.on("swipeup",()=>{i.value===l.PLAYING&&I()}),o.on("swipedown",()=>{i.value===l.PLAYING&&b()})}function F(){y&&(y.destroy(),y=null)}function K(){L()}function N(o){if(i.value===l.PLAYING)switch(o.key){case"ArrowLeft":G(-1),o.preventDefault();break;case"ArrowRight":G(1),o.preventDefault();break;case"ArrowUp":I(),o.preventDefault();break;case"ArrowDown":b(),o.preventDefault();break}}return Q(()=>{$(),H(),window.addEventListener("keydown",N)}),ee(()=>{F(),window.removeEventListener("keydown",N)}),(o,f)=>(P(),R(W,null,[u("div",de,[u("div",fe,[u("div",me,D(S(M)),1),u("div",pe,"ÊúÄÈ´òÂàÜÔºö"+D(S(s)),1)]),u("div",_e,[u("div",he,[u("div",{ref_key:"boardRef",ref:_,class:"board"},[(P(!0),R(W,null,Z(S(v),(h,E)=>(P(),R("div",{key:`row-${E}`,class:"board-row"},[(P(!0),R(W,null,Z(h,(e,a)=>(P(),R("div",{key:`cell-${E}-${a}`,class:"board-cell",style:ne(C(E,a))},D(x()),5))),128))]))),128))],512)])]),f[0]||(f[0]=oe('<div class="controls-info" data-v-991e1047><div class="control-item" data-v-991e1047><span class="control-icon" data-v-991e1047>‚Üê</span><span class="control-desc" data-v-991e1047>Â∑¶Áßª</span></div><div class="control-item" data-v-991e1047><span class="control-icon" data-v-991e1047>‚Üí</span><span class="control-desc" data-v-991e1047>Âè≥Áßª</span></div><div class="control-item" data-v-991e1047><span class="control-icon" data-v-991e1047>‚Üë</span><span class="control-desc" data-v-991e1047>ÊóãËΩ¨</span></div><div class="control-item" data-v-991e1047><span class="control-icon" data-v-991e1047>‚Üì</span><span class="control-desc" data-v-991e1047>Âø´ÈÄü‰∏ãËêΩ</span></div></div>',1))]),S(i)!==S(l).PLAYING?(P(),R("div",ge,[u("div",Ee,[f[1]||(f[1]=u("div",{class:"game-over-icon"},"üéÆ",-1)),f[2]||(f[2]=u("div",{class:"game-over-title"},"Ê∏∏ÊàèÁªìÊùü",-1)),u("div",we,"ÊúÄÁªàÂæóÂàÜÔºö"+D(S(p)),1),u("button",{class:"restart-button",onClick:K}," ÂÜçÊù•‰∏ÄÂ±Ä ")])])):re("",!0)],64))}}),ye=te(Ge,[["__scopeId","data-v-991e1047"]]),Pe={class:"tetris-view"},Re={class:"container"},Se={class:"game-layout"},Oe={class:"game-main"},be=j({__name:"TetrisView",setup(t){const v=ie();function i(){v.push("/")}return Q(()=>{const p=new BroadcastChannel("woodcat-games");p.onmessage=s=>{const d=s.data;d.type==="close-game"&&d.gameRoute!=="/game/tetris"&&(p.close(),window.close())},ee(()=>{p.close()})}),(p,s)=>(P(),R("div",Pe,[u("div",Re,[u("div",{class:"game-header"},[u("button",{onClick:i,class:"back-button"},"‚Üê ËøîÂõûÈ¶ñÈ°µ")]),u("div",Se,[u("div",Oe,[le(ye)])])])]))}}),Ie=te(be,[["__scopeId","data-v-d0ba83d6"]]);export{Ie as default};
