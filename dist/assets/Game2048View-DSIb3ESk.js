import{d as D,m as P,e as H,o as b,c as _,F as L,a as o,t as N,n as W,r as F,p as U,T as q,q as K,f as V,b as E,h as Y,_ as z,j as Z,u as I}from"./index-Crvd5xHI.js";import{H as A}from"./hammer-BRjDnnGP.js";var M=(s=>(s.UP="up",s.DOWN="down",s.LEFT="left",s.RIGHT="right",s))(M||{});const f=4,J=2,Q=30,X=.1,ee={class:"game2048-board"},te={class:"game-header"},oe={class:"game-status"},se={class:"score-container"},ne={class:"score-box"},ae={class:"score-value"},re={class:"score-box"},le={class:"score-value"},ie={class:"grid-background"},ce={key:0,class:"game-over-overlay"},ue={key:1,class:"game-won-overlay"},de=D({__name:"Game2048Board",props:{tiles:{},score:{},bestScore:{},gameOver:{type:Boolean},gameWon:{type:Boolean},statusText:{}},emits:["move","restart","continue"],setup(s,{emit:m}){const i=m,d=E(null);let l=null;function y(u){const n=100/f,r=1.5;return{left:`${u.col*n+r}%`,top:`${u.row*n+r}%`,width:`${n-r*2}%`,height:`${n-r*2}%`}}function T(u){const r={ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right",w:"up",s:"down",a:"left",d:"right"}[u.key];r&&(u.preventDefault(),i("move",r))}function k(){if(!d.value)return;l=new A.Manager(d.value);const u=new A.Swipe({direction:A.DIRECTION_ALL,threshold:Q});l.add(u),l.on("swipeleft",()=>i("move","left")),l.on("swiperight",()=>i("move","right")),l.on("swipeup",()=>i("move","up")),l.on("swipedown",()=>i("move","down"))}function x(){l&&(l.destroy(),l=null)}function g(){i("restart")}function v(){i("continue")}return P(()=>{window.addEventListener("keydown",T),k()}),H(()=>{window.removeEventListener("keydown",T),x()}),(u,n)=>(b(),_(L,null,[o("div",ee,[o("div",te,[n[0]||(n[0]=o("div",{class:"game-title"},"2048",-1)),o("div",oe,N(s.statusText),1)]),o("div",se,[o("div",ne,[n[1]||(n[1]=o("div",{class:"score-label"},"分数",-1)),o("div",ae,N(s.score),1)]),o("div",re,[n[2]||(n[2]=o("div",{class:"score-label"},"最高分",-1)),o("div",le,N(s.bestScore),1)])]),o("div",{ref_key:"boardRef",ref:d,class:W(["board",{"game-over":s.gameOver,"game-won":s.gameWon}])},[o("div",ie,[(b(),_(L,null,F(16,r=>o("div",{key:`bg-${r}`,class:"grid-cell"})),64))]),U(q,{name:"tile"},{default:K(()=>[(b(!0),_(L,null,F(s.tiles,r=>(b(),_("div",{key:r.id,class:W(["tile",[`tile-${r.value}`,{"tile-new":r.isNew,"tile-merged":r.isMerged}]]),style:Y(y(r))},N(r.value),7))),128))]),_:1})],2),o("div",{class:"game-controls"},[o("button",{class:"control-button",onClick:g},"重新开始"),n[3]||(n[3]=o("div",{class:"control-hint"},"使用方向键或滑动来移动方块",-1))])]),s.gameOver?(b(),_("div",ce,[o("div",{class:"overlay-content"},[n[4]||(n[4]=o("div",{class:"overlay-title"},"游戏结束",-1)),o("button",{class:"overlay-button",onClick:g}," 再来一局 ")])])):V("",!0),s.gameWon?(b(),_("div",ue,[o("div",{class:"overlay-content"},[n[5]||(n[5]=o("div",{class:"overlay-title"},"你赢了！",-1)),n[6]||(n[6]=o("div",{class:"overlay-subtitle"},"达到 2048",-1)),o("div",{class:"overlay-buttons"},[o("button",{class:"overlay-button",onClick:g}," 再来一局 "),o("button",{class:"overlay-button overlay-button-secondary",onClick:v}," 继续游戏 ")])])])):V("",!0)],64))}}),ve=z(de,[["__scopeId","data-v-4d97ff7e"]]);function fe(){const s=E([]),m=E(0),i=E(0),d=E(!1),l=E(!1);let y=0;const T=Z(()=>l.value?"你赢了！":d.value?"游戏结束":"游戏中");function k(){s.value=[],m.value=0,d.value=!1,l.value=!1,y=0;for(let t=0;t<J;t++)x()}function x(){const t=g();if(t.length===0)return;const e=t[Math.floor(Math.random()*t.length)],a=Math.random()<X?4:2,c={id:y++,value:a,row:e.row,col:e.col,isNew:!0};s.value.push(c)}function g(){const t=[];for(let e=0;e<f;e++)for(let a=0;a<f;a++)v(e,a)||t.push({row:e,col:a});return t}function v(t,e){return s.value.find(a=>a.row===t&&a.col===e)}function u(t){if(d.value||l.value)return!1;s.value.forEach(C=>{C.isMerged=!1,C.isNew=!1,delete C.mergedFrom});let e=!1;const a=n(t),c=r(a);return c.forEach(C=>{c.forEach($=>{const w=v(C,$);if(w){const p=h(C,$,a),G=v(p.next.row,p.next.col);if(G&&G.value===w.value&&!G.isMerged){const R={id:y++,value:w.value*2,row:p.next.row,col:p.next.col,mergedFrom:[w,G],isMerged:!0};s.value=s.value.filter(O=>O.id!==w.id&&O.id!==G.id),s.value.push(R),m.value+=R.value,R.value===2048&&(l.value=!0),e=!0}else(w.row!==p.farthest.row||w.col!==p.farthest.col)&&(w.row=p.farthest.row,w.col=p.farthest.col,e=!0)}})}),e&&(x(),B(),S()||(d.value=!0)),e}function n(t){return{[M.UP]:{row:-1,col:0},[M.DOWN]:{row:1,col:0},[M.LEFT]:{row:0,col:-1},[M.RIGHT]:{row:0,col:1}}[t]}function r(t){const e=[];for(let a=0;a<f;a++)e.push(a);return t.row===1&&e.reverse(),t.col===1&&e.reverse(),e}function h(t,e,a){let c;do c={row:t,col:e},t+=a.row,e+=a.col;while(t>=0&&t<f&&e>=0&&e<f&&!v(t,e));return{farthest:c,next:{row:t,col:e}}}function S(){if(g().length>0)return!0;for(let t=0;t<f;t++)for(let e=0;e<f;e++){const a=v(t,e);if(a){if(e<f-1){const c=v(t,e+1);if(c&&c.value===a.value)return!0}if(t<f-1){const c=v(t+1,e);if(c&&c.value===a.value)return!0}}}return!1}function B(){m.value>i.value&&(i.value=m.value)}function j(){k()}return{tiles:s,score:m,bestScore:i,gameOver:d,gameWon:l,statusText:T,initGame:k,move:u,restartGame:j}}const me={class:"game2048-view"},ge={class:"container"},we={class:"game-layout"},he={class:"game-main"},pe=D({__name:"Game2048View",setup(s){const{tiles:m,score:i,bestScore:d,gameOver:l,gameWon:y,statusText:T,initGame:k,move:x,restartGame:g}=fe();function v(h){x(h)}function u(){g()}function n(){g()}function r(){window.close()}return P(()=>{k();const h=new BroadcastChannel("woodcat-games");h.onmessage=S=>{const B=S.data;B.type==="close-game"&&B.gameRoute!=="/game/2048"&&(h.close(),window.close())},H(()=>{h.close()})}),(h,S)=>(b(),_("div",me,[o("div",ge,[o("div",{class:"game-header"},[o("button",{onClick:r,class:"back-button"},"← 返回首页")]),o("div",we,[o("div",he,[U(ve,{tiles:I(m),score:I(i),"best-score":I(d),"game-over":I(l),"game-won":I(y),"status-text":I(T),onMove:v,onRestart:u,onContinue:n},null,8,["tiles","score","best-score","game-over","game-won","status-text"])])])])]))}}),_e=z(pe,[["__scopeId","data-v-40021eca"]]);export{_e as default};
